<!DOCTYPE html>
 <html>
   <head>
    <title>Geometric recursive patterns generating system</title>
    <link rel="stylesheet" href="../css/button.css">
    <script src="../js/jquery-3.3.1.min.js"></script>
   </head>
   <body>
    <canvas id="Canvas" width="800" height="800" style="border:1px solid #000000;"></canvas>
    <div id="displays" style="position:relative; color:red; font-size:50px; 
        top:-110px; left:1000px;">
      <p id="iterations_display" style="visibility: hidden">0 Iterations.</p>
    </div>
    <script src="../js/global.js"></script>
    <script src="../js/function.js"></script>
    <script src="../js/class.js"></script>
    <script>
      //  animate FPS control
      var fps, fpsInterval, startTime, now, then, elapsed;
      fps = 60;

      //objects
      var pf;  //PlanetFactory
      var ps;  //PlanetSet
      var orbit;  //Orbit
      var draw;  //Draw

      var SYSTEM_MODE = SOLAR_SYSTEM;
      var RELATIVE_MODE = MRM;
      var RECURSIVE_LEVEL = 2;
      var ANGULAR_INCREMENTS_1 = 0.1, ANGULAR_INCREMENTS_2 = 0.9;
      var ANIMATE_SPEED = 3;
    </script>

    <script src="../js/api.js"></script>
    <script src="../js/jquery.api.js"></script>

    <script>

      init();
      main();

      function setParameter(rl, rm, zoom, color){
        RELATIVE_MODE = rm;
        RECURSIVE_LEVEL = rl;
        changeParameter(zoom, color);
      }

      function init(){
        pf = new PlanetFactory(RECURSIVE_LEVEL, RELATIVE_MODE);
        ps = pf.createPlanet();
        orbit = new Orbit(ps);
        draw = new Draw(orbit, ps);
      }

      function changeParameter(zoom, color){
        pf.set(RECURSIVE_LEVEL, RELATIVE_MODE);
        ps = pf.createPlanet();
        orbit.set(ps, zoom, color);
        draw.set(orbit, ps);
      }

      function redraw(a1, a2){
        draw.reset();

        var cnt = 0;
        if (RELATIVE_MODE == MRM)
          cnt ++;
        ps.setAnGularIncrements(cnt++, a1);
        ps.setAnGularIncrements(cnt++, a2);
        if (RECURSIVE_LEVEL > 2)
          ps.setAnGularIncrements(cnt++, -0.1);

        //toggleLoadingText("visible");
        orbit.calculate();
        //toggleLoadingText("hidden");
        draw.drawOrbit();
      }

      function main(){
        setParameter(2, RMRM, 1.5, '#ff0000');
        redraw(0.1, 0.9);
        setParameter(2, RMRM, 2.0, '#00ff00');
        redraw(0.1, 0.9);
        setParameter(2, RMRM, 1.0, '#0000ff');
        redraw(0.3, 0.7);

        display();
      }

      function display(){
        fpsInterval = 1000 / fps;
        then = Date.now();
        startTime = then;
        animate();
      }

      function animate(){
        requestAnimationFrame(animate);

        now = Date.now();
        elapsed = now - then;

        if (elapsed > fpsInterval){
          then = now - (elapsed % fpsInterval);
        }
        update();
      }

      function update(){
        //clearCanvas();
        draw.update();
      }
     </script>
   </body>
 </html>