<!DOCTYPE html>
 <html>
   <head>
    <title>Geometric recursive patterns generating system</title>
    <link rel="stylesheet" href="../css/button.css">
    <script src="../js/jquery-3.3.1.min.js"></script>
   </head>
   <body>
    <canvas id="Canvas" width="800" height="800" style="border:1px solid #000000;"></canvas>
    <div id="displays" style="position:relative; color:red; font-size:50px; 
        top:-110px; left:1000px;">
      <p id="iterations_display" style="visibility: visible;">0 Iterations.</p>
    </div>
    <div id="new_pattern" style="position:relative; top:-930px; left:1200px;">
      <p style="font-size:50px; color:#dd4444"><b>New Pattern</b></p>
      <div id="relative_level" style="position:relative; left:-120px; font-size:20px">
        <b>Relative Level:</b><br/>
        <input type="number" name="relativelevel" min="2" value="2">
      </div>
      <div id="relative_mode" style="position:relative; left:220px; top:-45px; font-size:20px">
        <b>Relative Mode:</b><br/>
        <input type="radio" name="relativemode" value="MRM" checked>MRM
        <input type="radio" name="relativemode" value="RMRM">RMRM
      </div>
      <div id="pattern_size" style="position:relative; left:-120px; font-size:20px">
        <b>Pattern Size:</b><br/>
        <input type="text" name="patternsize" value="1.0">
      </div>
      <div id="pattern_color" style="position:relative; left:220px; top:-45px; font-size:20px">
        <b>Pattern Color:</b><br/>
        <input type="color" name="patterncolor">
      </div>
      <div id="angular_increments" style="position:relative; left:-120px; font-size:20px">
        <b>Angular Increments:</b><br/>
        <input type="text" name="angularincrements" value="0.1,0.9">
      </div>
      <div id="line_width" style="position:relative; left:220px; top:-45px; font-size:20px">
        <b>Line Width:</b><br/>
        <input type="number" name="linewidth" min="1" value="1">
      </div>
      <div id="create_clear" style="position:relative; left:-50px; top:70px; font-size:20px">
        <button class="button" value="create">Create</button>
        <button class="button" value="clear">Clear</button>
        <button class="button" value="animate" disabled>Animate</button>
      </div>
    </div>
    <script src="../js/global.js"></script>
    <script src="../js/function.js"></script>
    <script src="../js/class.js"></script>
    <script>
      //  animate FPS control
      var fps, fpsInterval, startTime, now, then, elapsed;
      fps = 60;

      //objects
      var pf;  //PlanetFactory
      var ps;  //PlanetSet
      var orbit;  //Orbit
      var draw;  //Draw

      var SYSTEM_MODE = SOLAR_SYSTEM;
      var RELATIVE_MODE = MRM;
      var RECURSIVE_LEVEL = 2;
      var ANGULAR_INCREMENTS_1 = 0.1, ANGULAR_INCREMENTS_2 = 0.9;
      var ANIMATE_SPEED = 10;
    </script>

    <script src="../js/api.js"></script>
    <script src="../js/jquery.api.js"></script>

    <script>

      init();
      main();

      function setParameter(rl, rm, zoom, color, width){
        RECURSIVE_LEVEL = rl;
        RELATIVE_MODE = rm;
        changeParameter(zoom, color, width);
      }

      function init(){
        pf = new PlanetFactory(RECURSIVE_LEVEL, RELATIVE_MODE);
        ps = pf.createPlanet();
        orbit = new Orbit(ps);
        draw = new Draw(orbit, ps);
      }

      function changeParameter(zoom, color, width){
        pf.set(RECURSIVE_LEVEL, RELATIVE_MODE);
        ps = pf.createPlanet();
        orbit.set(ps, zoom, color);
        draw.set(orbit, ps, width);
      }

      function redraw(angular){  //string
        draw.reset();

        var split_parameter = angular.split(',');
        if (split_parameter.length != RECURSIVE_LEVEL){
          alert("Angular Increments number is wrong!");
          return;
        }
        var s, e, i;
        s = RELATIVE_MODE == MRM ? 1 : 0;
        e = s + RECURSIVE_LEVEL;
        for (i = 0; s < e; s++, i++){
          ps.setAnGularIncrements(s, Number(split_parameter[i]));
        }

        //toggleLoadingText("visible");
        orbit.calculate();
        //toggleLoadingText("hidden");
        draw.drawOrbit();
      }

      function main(){
        /*
        setParameter(2, RMRM, 1.5, '#ff0000');
        redraw(0.1, 0.9);
        setParameter(2, RMRM, 2.0, '#00ff00');
        redraw(0.1, 0.9);
        setParameter(2, RMRM, 1.0, '#0000ff');
        redraw(0.3, 0.7);
        */

        display();
      }

      function display(){
        fpsInterval = 1000 / fps;
        then = Date.now();
        startTime = then;
        animate();
      }

      function animate(){
        requestAnimationFrame(animate);

        now = Date.now();
        elapsed = now - then;

        if (elapsed > fpsInterval){
          then = now - (elapsed % fpsInterval);
        }
        update();
      }

      function update(){
        //clearCanvas();
        draw.update();
      }
     </script>
   </body>
 </html>